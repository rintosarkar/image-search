<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="stylesheet" href="/build/tailwind.css">
    <title>Image Search From PIXABAY</title>
</head>

<body class="antialiased">
    <div class="main" x-data="searchModule">
        <div class="bg-gray-800 text-gray-200 bg-cover bg-blend-overlay" :style="cover">
            <h1 class="text-3xl text-center pt-11">Image Search From PIXABAY</h1>
            <div class="flex flex-col p-12 space-y-3 w-96 mx-auto">
                <input @keydown.enter="getImages()" x-model="searchKey" type="text" class="focus:outline-none rounded-md text-gray-700 pl-3 h-10 border border-gray-200" placeholder="Type Keyword and hit Enter">
                <button @click="getImages()" class="bg-green-400 h-10 rounded-md text-white font-bold focus:outline-none">Search</button>
                <p>* Powered by pixabay</p>
            </div>
        </div>
        <div class="h-auto text-white text-center p-5">

            <!-- <p class="bg-gray-500 text-left" x-text="modal"></p> -->


            <template x-for="(image,index) in images" class="flex flex-row mt-15 space-x-3 space-y-2">
                <div class="inline-block">
                  <a @click="$dispatch('img-modal', { allImages:images, imgModalSrc: image.largeImageURL, imgModalDesc: image.tags })" class="cursor-pointer" >
                    <img class="inline-block w-96 h-64 p-3"  :src="image.webformatURL" :title="image.tags" alt="" loading="lazy">
                  </a>
                </div>
            </template>
        </div>

    </div>

    <div x-data="modalImage">
        <template @img-modal.window="imgModal = true; allImages:$event.detail.images; imgModalSrc = $event.detail.imgModalSrc; imgModalDesc = $event.detail.imgModalDesc;" x-if="imgModal">
          <div x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform scale-90" x-transition:enter-end="opacity-100 transform scale-100" x-transition:leave="transition ease-in duration-300" x-transition:leave-start="opacity-100 transform scale-100" x-transition:leave-end="opacity-0 transform scale-90" x-on:click.away="imgModalSrc = ''" class="p-2 fixed w-full h-100 inset-0 z-50 overflow-hidden flex justify-center items-center bg-black bg-opacity-75">
            <div @click.away="imgModal = ''" class="flex flex-col max-w-7xl max-h-full overflow-auto">
              <div class="z-50">
                <button @click="imgModal = ''" class="float-right pt-2 pr-2 outline-none focus:outline-none">
                  <svg class="fill-current text-white " xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
                    <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z">
                    </path>
                  </svg>
                </button>
                <!-- <button @click="nextImage(allImages)" class="bg-red-500">Next</button>
                <button class="bg-red-500">Pre</button> -->
                
              </div>
              
              <div class="p-2">
                <img :alt="imgModalSrc" class="object-contain w-full h-1/2-screen" :src="imgModalSrc">
                <p x-text="imgModalDesc" class="text-center text-white"></p>
              </div>
            </div>
          </div>
        </template>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
    <script>
        const searchModule = {
            apiKey: '446376-3cb74bf737ef0b737968310c6',
            apiUrl: 'https://pixabay.com/api?image_type=photo&orientation=horizontal&per_page=50',
            accessKey: 'wa-tcHndp_cnkKk0GxL8I8P4z0EISz7LNdD2PonneV4',
            secretKey: '2cP103k7FYabDNGK_i8HPfilXs9l_H2_LKPSxXVaF2k',
            searchKey: '',
            modal: false,
            images: [],
            cover: "",
            getImages() {
                const requestUrl = `${this.apiUrl}&q=${this.searchKey}&key=${this.apiKey}`
                const count = Math.floor(Math.random() * (49 - 0 + 1)) + 0;
                fetch(requestUrl)
                    .then(res => res.json())
                    .then(data => {
                        this.images = data.hits
                        this.cover = "background-image: url('" + data.hits[count].largeImageURL + "');"
                    })

                console.log(count)


            }
        }

        const modalImage = {
            imgModal: false,
            imgModalSrc: '',
            imgModalDesc: '',
            allImages: [],
            nextImage(ai) {
                const keys = Object.keys(ai)
                console.log(keys)

            }
        }
    </script>








</body>

</html